var M=Object.defineProperty;var q=(e,t,n)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var v=(e,t,n)=>(q(e,typeof t!="symbol"?t+"":t,n),n);import{r as g,u as $,a as F,j as i,c as D,g as L,R as G,b as z}from"./index-qkLRFn1S.js";const N=g.forwardRef(({as:e,bsPrefix:t,variant:n="primary",size:s,active:r=!1,disabled:o=!1,className:d,...l},u)=>{const f=$(t,"btn"),[p,{tagName:c}]=F({tagName:e,disabled:o,...l}),m=c;return i.jsx(m,{...p,...l,ref:u,disabled:o,className:D(d,f,r&&"active",n&&`${f}-${n}`,s&&`${f}-${s}`,l.href&&o&&"disabled")})});N.displayName="Button";const H=g.forwardRef(({bsPrefix:e,className:t,striped:n,bordered:s,borderless:r,hover:o,size:d,variant:l,responsive:u,...f},p)=>{const c=$(e,"table"),m=D(t,c,l&&`${c}-${l}`,d&&`${c}-${d}`,n&&`${c}-${typeof n=="string"?`striped-${n}`:"striped"}`,s&&`${c}-bordered`,r&&`${c}-borderless`,o&&`${c}-hover`),h=i.jsx("table",{...f,className:m,ref:p});if(u){let S=`${c}-responsive`;return typeof u=="string"&&(S=`${S}-${u}`),i.jsx("div",{className:S,children:h})}return h}),B=g.forwardRef(({bsPrefix:e,bg:t="primary",pill:n=!1,text:s,className:r,as:o="span",...d},l)=>{const u=$(e,"badge");return i.jsx(o,{ref:l,...d,className:D(r,u,n&&"rounded-pill",s&&`text-${s}`,t&&`bg-${t}`)})});B.displayName="Badge";const P=g.forwardRef(({bsPrefix:e,size:t,vertical:n=!1,className:s,role:r="group",as:o="div",...d},l)=>{const u=$(e,"btn-group");let f=u;return n&&(f=`${u}-vertical`),i.jsx(o,{...d,ref:l,role:r,className:D(s,f,t&&`${u}-${t}`)})});P.displayName="ButtonGroup";var K={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const _=e=>{let t;const n=new Set,s=(p,c)=>{const m=typeof p=="function"?p(t):p;if(!Object.is(m,t)){const h=t;t=c??(typeof m!="object"||m===null)?m:Object.assign({},t,m),n.forEach(S=>S(t,h))}},r=()=>t,u={setState:s,getState:r,getInitialState:()=>f,subscribe:p=>(n.add(p),()=>n.delete(p)),destroy:()=>{(K?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},f=t=e(s,r,u);return u},Q=e=>e?_(e):_;var V={exports:{}},W={},k={exports:{}},A={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y=g;function X(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Y=typeof Object.is=="function"?Object.is:X,Z=y.useState,ee=y.useEffect,te=y.useLayoutEffect,ne=y.useDebugValue;function se(e,t){var n=t(),s=Z({inst:{value:n,getSnapshot:t}}),r=s[0].inst,o=s[1];return te(function(){r.value=n,r.getSnapshot=t,O(r)&&o({inst:r})},[e,n,t]),ee(function(){return O(r)&&o({inst:r}),e(function(){O(r)&&o({inst:r})})},[e]),ne(n),n}function O(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Y(e,n)}catch{return!0}}function re(e,t){return t()}var oe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?re:se;A.useSyncExternalStore=y.useSyncExternalStore!==void 0?y.useSyncExternalStore:oe;k.exports=A;var ie=k.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R=g,ce=ie;function ue(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ae=typeof Object.is=="function"?Object.is:ue,de=ce.useSyncExternalStore,le=R.useRef,pe=R.useEffect,fe=R.useMemo,he=R.useDebugValue;W.useSyncExternalStoreWithSelector=function(e,t,n,s,r){var o=le(null);if(o.current===null){var d={hasValue:!1,value:null};o.current=d}else d=o.current;o=fe(function(){function u(h){if(!f){if(f=!0,p=h,h=s(h),r!==void 0&&d.hasValue){var S=d.value;if(r(S,h))return c=S}return c=h}if(S=c,ae(p,h))return S;var C=s(h);return r!==void 0&&r(S,C)?S:(p=h,c=C)}var f=!1,p,c,m=n===void 0?null:n;return[function(){return u(t())},m===null?void 0:function(){return u(m())}]},[t,n,s,r]);var l=de(e,o[0],o[1]);return pe(function(){d.hasValue=!0,d.value=l},[l]),he(l),l};V.exports=W;var me=V.exports;const Se=L(me);var J={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{useDebugValue:ge}=G,{useSyncExternalStoreWithSelector:ye}=Se;let U=!1;const ve=e=>e;function xe(e,t=ve,n){(J?"production":void 0)!=="production"&&n&&!U&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),U=!0);const s=ye(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return ge(s),s}const I=e=>{(J?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?Q(e):e,n=(s,r)=>xe(t,s,r);return Object.assign(n,t),n},Ee=e=>e?I(e):I;let b;const be=new Uint8Array(16);function we(){if(!b&&(b=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!b))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return b(be)}const a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function je(e,t=0){return a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]}const $e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),T={randomUUID:$e};function w(e,t,n){if(T.randomUUID&&!t&&!e)return T.randomUUID();e=e||{};const s=e.random||(e.rng||we)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,je(s)}const x=Ee(e=>({connected:!1,devices:[],setConnnected:t=>e({connected:t}),setDevices:t=>e({devices:t})})),j=class j{constructor(){v(this,"url",`ws://${window.location.hostname}:3000/api/control`);v(this,"ws");v(this,"reconnectTimer")}connect(){this.ws&&this.ws.close(),this.ws=new WebSocket(this.url),this.ws.onopen=this.onOpen.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onclose=this.onClose.bind(this)}onOpen(){console.log("Connected to server"),x.getState().setConnnected(!0),clearTimeout(this.reconnectTimer)}onClose(){console.log("Disconnected from server"),x.getState().setConnnected(!1),this.reconnectTimer=setTimeout(()=>this.connect(),1e3)}onMessage(t){let n;try{n=JSON.parse(t.data)}catch{console.log("Error parsing message",t.data);return}if(Object.prototype.hasOwnProperty.call(n.result,"sync")){let s=n.result.sync;return s=s.sort(({device_num:r},{device_num:o})=>o-r),x.getState().setDevices(s)}}send(t){var n,s;if(((n=this.ws)==null?void 0:n.readyState)===WebSocket.OPEN&&x.getState().connected)return(s=this.ws)==null?void 0:s.send(t);console.log("Websocket not open, not sending message",t),setTimeout(()=>this.send(t),1e3)}start(t){this.send(JSON.stringify({id:w().toString(),command:{start:{device_id:t}}}))}stop(t){this.send(JSON.stringify({id:w().toString(),command:{stop:{device_id:t}}}))}sync(){this.send(JSON.stringify({id:w().toString(),command:{sync:{}}}))}ping(){this.send(JSON.stringify({id:w().toString(),command:{ping:{}}}))}};v(j,"shared",new j);let E=j;const Ne=z("/")({component:De});function De(){g.useEffect(()=>{E.shared.connect()},[]);const e=s=>{E.shared.start(s)},t=s=>{E.shared.stop(s)},{devices:n}=x();return i.jsx("div",{className:"p-2",children:i.jsxs(H,{bordered:!0,hover:!0,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"#"}),i.jsx("th",{children:"Device id"}),i.jsx("th",{children:"State"}),i.jsx("th",{children:"Control"})]})}),i.jsx("tbody",{children:n.map(s=>i.jsxs("tr",{children:[i.jsx("td",{children:s.device_num}),i.jsx("td",{children:s.id}),i.jsx("td",{children:i.jsx(B,{bg:"secondary",children:s.state})}),i.jsx("td",{children:i.jsxs(P,{children:[i.jsx(N,{variant:"primary",onClick:()=>e(s.id),children:"Start"}),i.jsx(N,{variant:"danger",onClick:()=>t(s.id),children:"Stop"})]})})]}))})]})})}export{Ne as Route};
